#include "../../imports/stdlib.fc";
#include "../../imports/tsa_functions.fc";

() on_internal_message_send(int balance, int msg_value, cell in_msg_full, slice msg_body, int input_id) impure method_id {

    tsa_forbid_failures();

    slice cs = in_msg_full.begin_parse();
    int flags = cs~load_uint(4);
    tsa_assert_not(flags & 1);

    int op = msg_body~load_uint(32);
    tsa_assert(op == 100);

    tsa_assert(msg_value >= 1000000000);

    tsa_allow_failures();
}

() main() impure {

    int balance_bfr_msg = tsa_call_1_0(1, 1650);

    tsa_forbid_failures();
    tsa_assert(balance_bfr_msg > 1000000);
    tsa_allow_failures();

    tsa_send_internal_message(1, 0);

    int balance_aft_msg = tsa_call_1_0(1, 1650);

    throw_if(257, balance_aft_msg < 500000); ;; unreachable, as fees are not this bad
}
