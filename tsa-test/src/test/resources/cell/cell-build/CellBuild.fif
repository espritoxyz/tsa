"../../fiftstdlib/Fift.fif" include
"../../fiftstdlib/Asm.fif" include

PROGRAM{
  0  DECLMETHOD stsliceconst
  1  DECLMETHOD stzeroes
  2  DECLMETHOD sdskipfirst
  3  DECLMETHOD sdsubstr
  4  DECLMETHOD sdsubstr_bad_offset
  5  DECLMETHOD sdsubstr_bad_size
  6  DECLMETHOD sdsubstr_bad_last_bit
  7  DECLMETHOD stones_small
  8  DECLMETHOD stones
  9  DECLMETHOD stones_large
  10  DECLMETHOD stdict_large

  stsliceconst PROC:<{
    192 PUSHINT
    NEWC
    8 STU
    b{00010000000000} STSLICECONST
    ENDC
    HASHCU
  }>

  stzeroes PROC:<{
    192 PUSHINT
    NEWC
    8 STU
    6 PUSHINT
    STZEROES
    ENDC
    HASHCU
  }>

  stones_small PROC:<{
    NEWC
    3 PUSHINT
    STONES
    ENDC
    HASHCU
  }>

  stones PROC:<{
    192 PUSHINT
    NEWC
    8 STU
    6 PUSHINT
    STZEROES
    ENDC
    HASHCU
  }>

  stones_large PROC:<{
    192 PUSHINT
    NEWC
    8 STU
    300 PUSHINT
    STONES
    ENDC
    HASHCU
  }>

  sdskipfirst PROC:<{
    5565 PUSHINT // 0b1010110111101, 13 chars
    NEWC
    13 STU
    ENDC
    CTOS
    3 PUSHINT
    SDSKIPFIRST
    HASHSU
  }>

  sdsubstr PROC:<{
    5565 PUSHINT // 0b1010110110101, 13 chars
    NEWC
    13 STU
    ENDC
    CTOS
    3 PUSHINT
    4 PUSHINT
    SDSUBSTR // 0b0110
    4 LDU
    DROP
  }>

  sdsubstr_bad_offset PROC:<{
    5565 PUSHINT // 0b1010110110101, 13 chars
    NEWC
    13 STU
    ENDC
    CTOS
    1025 PUSHINT // big offset; integer-out-of-range (exit code 5) in sdsubstr below
    4 PUSHINT
    SDSUBSTR
    4 LDU
    DROP
  }>

  sdsubstr_bad_size PROC:<{
    5565 PUSHINT // 0b1010110110101, 13 chars
    NEWC
    13 STU
    ENDC
    CTOS
    4 PUSHINT
    1025 PUSHINT // big substring length; integer-out-of-range (exit code 5) in sdsubstr below
    SDSUBSTR
    4 LDU
    DROP
  }>

  sdsubstr_bad_last_bit PROC:<{
    5565 PUSHINT // 0b1010110110101, 13 chars
    NEWC
    13 STU
    ENDC
    CTOS
    800 PUSHINT
    800 PUSHINT // big sum; cell-underflow (exit code 9) in sdsubstr below
    SDSUBSTR
    4 LDU
    DROP
  }>

  stdict_large PROC:<{
    NULL

    // 1023-bit slice
    0 PUSHINT
    0 PUSHINT
    0 PUSHINT
    0 PUSHINT
    NEWC
    256 STU
    256 STU
    256 STU
    255 STU
    ENDC
    CTOS

    NEWC
    STSLICE
    STDICT  // throws cell overflow
  }>

}END>c