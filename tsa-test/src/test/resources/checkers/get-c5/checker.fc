#include "../../imports/stdlib.fc";
#include "../../imports/tsa_functions.fc";


() on_compute_phase_exit(cell c5, int exit_code, int compute_fee, int contract_id) impure method_id {
    var actions = c5.begin_parse();
    var count = 0;
    var i = 0;
    while (i < 5) {
        i += 1;
        if (actions.slice_refs() > 0) {
            actions = actions.preload_ref().begin_parse();
            count = count + 1;
        }
    }
    throw(600 + count);
}

() on_internal_message_send(int balance, int msg_value, cell in_msg_full, slice msg_body, int input_id) impure method_id {
    tsa_forbid_failures();

    slice cs = in_msg_full.begin_parse();
    int flags = cs~load_uint(4);
    tsa_assert_not(flags & 1);
    int op = msg_body~load_uint(32);
    tsa_assert(op == 100);
    tsa_allow_failures();
}

() main() impure {
    tsa_send_internal_message(1, 0);
    throw(401);
}
