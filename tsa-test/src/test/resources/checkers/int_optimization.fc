#include "../imports/stdlib.fc";
#include "../imports/tsa_functions.fc";

() main() impure {
    tsa_forbid_failures();

    ;; Initialize C4 for contract
    slice stateSlice = tsa_get_c4(1).begin_parse();
    int loaded = stateSlice~load_int(1);
    int consecutiveWins = stateSlice~load_coins();
    int triesCount = stateSlice~load_coins();
    tsa_assert(loaded == -1);                           ;; The contract should be loaded
    tsa_assert(consecutiveWins == 0);                   ;; Initially, consecutiveWins is 0
    tsa_assert(triesCount == 0);                        ;; Initially, triesCount is 0

    int count = 0;

    repeat(3) {
        tsa_send_internal_message(1, count);
        count = count + 1;
    }

    tsa_allow_failures();

    throw(257);
}
